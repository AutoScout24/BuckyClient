/*! bucky 0.1.13 */
(function(){var a,b,c,d=[].slice;c=null!=("undefined"!=typeof process&&null!==process?process.hrtime:void 0)?function(){var a;return a=process.hrtime(),1e3*(a[0]+a[1]/1e9)}:function(){var a,b;return null!=(a=null!=(b=window.performance)?"function"==typeof b.now?b.now():void 0:void 0)?a:+new Date},b=+new Date,a=function(a,e,f,g){var h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,A,B,C,D,E,F,G;return n=3e4,i=5e3,k=3,p=!0,o=1,q={timer:"ms",gauge:"g",counter:"c"},m={prod:"https://app.hubspot.com/bucky",qa:"https://app.hubspotqa.com/bucky"},j=null!=(F=m[a.getInternal("api.bucky")])?F:m.qa,h=Math.random()<o,r=!0,l={},B=function(a,b){return null==b&&(b=k),a.toFixed(b)},A={},u=function(a,b,c){var d,e;if(h)return d=1,a in A&&("counter"===c?b+=A[a].value:(d=null!=(e=A[a].count)?e:d,d++,b=A[a].value+(b-A[a].value)/d)),l[a]=A[a]={value:b,type:c,count:d},s()},D=null,z=null,w=function(){return clearTimeout(D),clearTimeout(z),z=null,D=null,C()},s=function(){return clearTimeout(D),D=setTimeout(w,i),null==z?z=setTimeout(w,n):void 0},C=function(){var b,d,e,g,h,i;if("function"==typeof a.deployed?a.deployed("bucky"):void 0){d={};for(b in A)e=A[b],null!=q[e.type]?"timer"===e.type&&e.value>12e4||(h=e.value,("gauge"===(i=e.type)||"timer"===i)&&(h=B(h)),d[b]=""+h+"|"+q[e.type],1!==e.count&&(d[b]+="@"+B(1/e.count,5))):console.error("Type "+e.type+" not understood by Bucky");return g=c(),f.ajax({url:j+"/send",type:"POST",contentType:"application/json",data:JSON.stringify(d),_buckySend:!0,error:function(a){return console.error(a,"sending data")},success:function(){var a;return a=c(),E(a-g)}}),A={}}},t=0,x=!1,E=function(a){return t=a,p&&!x?(u("bucky.latency",a,"timer"),x=!0,setTimeout(function(){return x=!1},3e5)):void 0},y=function(f){var i,j,k,m,n,o,p,q,s;return null==f&&(f=""),i=function(b){return(null!=f?f.length:void 0)&&(b=f+"."+b),b.replace(".ENV.","."+a.getInternal("bucky")+".")},o=function(a,b,c){return null==c&&(c="gauge"),u(i(a),b,c)},s={TIMES:{},send:function(a,b){return o(a,b,"timer")},time:function(){var a,b,c,e,f;return f=arguments[0],a=arguments[1],c=arguments[2],b=4<=arguments.length?d.call(arguments,3):[],s.start(f),e=function(){return s.stop(f)},b.splice(0,0,e),a.apply(c,b)},timeSync:function(){var a,b,c,e,f;return e=arguments[0],a=arguments[1],c=arguments[2],b=4<=arguments.length?d.call(arguments,3):[],s.start(e),f=a.apply(c,b),s.stop(e),f},wrap:function(a,b){return null!=b?function(){var c;return c=1<=arguments.length?d.call(arguments,0):[],s.timeSync.apply(s,[a,b,this].concat(d.call(c)))}:function(b){return function(){var c;return c=1<=arguments.length?d.call(arguments,0):[],s.timeSync.apply(s,[a,b,this].concat(d.call(c)))}}},start:function(a){return s.TIMES[a]=c()},stop:function(a){var b;return null==s.TIMES[a]?(console.error("Timer "+a+" ended without having been started"),void 0):(b=c()-s.TIMES[a],s.TIMES[a]=void 0,s.send(a,b))},stopwatch:function(a,b){var d,e;return null!=b?e=function(){return+new Date}:(b=c(),e=c),d=b,{mark:function(c,d){var f;return null==d&&(d=0),f=e(),a&&(c=a+"."+c),s.send(c,f-b+d)},split:function(b,c){var f;return null==c&&(c=0),f=e(),a&&(b=a+"."+b),s.send(b,f-d+c),d=f}}},mark:function(a,b){var c;return null==b&&(b=+new Date),c=s.navigationStart(),s.send(a,b-c)},navigationStart:function(){var a,c,d;return null!=(a="undefined"!=typeof window&&null!==window?null!=(c=window.performance)?null!=(d=c.timing)?d.navigationStart:void 0:void 0:void 0)?a:b},responseEnd:function(){var a,c,d;return null!=(a="undefined"!=typeof window&&null!==window?null!=(c=window.performance)?null!=(d=c.timing)?d.responseEnd:void 0:void 0:void 0)?a:b},now:function(){return c()}},j=function(a,b){return null==b&&(b=1),o(a,b,"counter")},q=!1,p=function(a){var b,c,d,e,f,g;if(null==a&&(a="timing"),null==("undefined"!=typeof window&&null!==window?null!=(e=window.performance)?e.timing:void 0:void 0))return!1;if(q)return!1;if("uninitialized"===(f=document.readyState)||"loading"===f)return"function"==typeof document.addEventListener&&document.addEventListener("DOMContentLoaded",function(){return p.apply(this,arguments)}),void 0;q=!0,c=window.performance.timing.navigationStart,g=window.performance.timing;for(b in g)d=g[b],0!==d&&o(""+a+"."+b,d-c,"timer");return!0},n={sendReadyStateTimes:function(a,b){var c,d,e,f,g,h,i,j;if(null!=b){d={1:"sending",2:"headers",3:"waiting",4:"receiving"},e={},f=null;for(c in b)h=b[c],null!=f&&null!=d[c]&&(e[d[c]]=h-f),f=h;j=[];for(g in e)i=e[g],j.push(o(""+a+"."+g,i,"timer"));return j}},urlToKey:function(a,b,c){var d,e,f,g,h;return a=a.replace(/https?:\/\//i,""),e=/([^/:]*)(?::\d+)?(\/[^\?#]*)?.*/i.exec(a),d=e[1],f=null!=(h=e[2])?h:"",f=f.replace(/\/events?\/\w{8,12}/gi,"/events"),f=f.replace(/\/campaigns?\/\w{15}(\w{3})?/gi,"/campaigns"),f=f.replace(/\/_[^/]+/g,""),f=f.replace(/\.js$/,""),f=f.replace(/\/[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}/gi,""),f=f.replace(/\/[0-9a-f]{40}/gi,""),f=f.replace(/\/[0-9a-f]{32}/gi,""),f=f.replace(/\/[0-9;_\-]+/g,""),f=f.replace(/\/[^/]+@[^/]+/g,""),f=f.replace(/\/[^/]+\.[a-z]{2,3}/gi,""),f=f.replace(/\/static(\-\d+\.\d+)?/g,"/static"),f=decodeURIComponent(f),f=f.replace(/[^a-zA-Z0-9\-\.\/ ]+/g,"_"),g=d+f.replace(/[\/ ]/g,"."),g=g.replace(/(^\.)|(\.$)/g,""),g=g.replace(/\.com/,""),g=g.replace(/www\./,""),c&&(g=c+"."+g),b&&(g=g+"."+b.toLowerCase()),g=g.replace(/\.\./g,".")},getFullUrl:function(a,b){return null==b&&(b=document.location),/^\//.test(a)?b.hostname+a:/https?:\/\//i.test(a)?a:b.toString()+a},monitor:function(a){var b,d;return null==a&&(a="requests"),b=void 0,jQuery(document).ajaxSend(g.wrap(function(a,d){return d.startTime=c(),b=d})),jQuery.ajaxSettings.xhr=function(){var a,d;try{d=new XMLHttpRequest}catch(e){a=e}return g.run(function(){return null!=d&&(d.readyStateTimes={0:c()}),null!=b&&(b.realXHR=d),b=null,null!=d?d.addEventListener("readystatechange",function(){return d.readyStateTimes[d.readyState]=c()}):void 0}),d},d=this,jQuery(document).ajaxComplete(g.wrap(function(b,e,f){var g,h,i,k;if(!f._buckySend)return null==e.startTime?(r&&hlog("A request was completed which Bucky did not record having been started.  Is bucky.request.monitor being called too late?"),r=!1,void 0):(g=c()-e.startTime,i=f.url,i=d.getFullUrl(i),h=d.urlToKey(i,f.type,a),o(h,g,"timer"),d.sendReadyStateTimes(h,null!=(k=e.realXHR)?k.readyStateTimes:void 0),null!=(null!=e?e.status:void 0)?((null!=e?e.status:void 0)>12e3?j(""+h+".0"):0!==e.status&&j(""+h+"."+e.status.toString().charAt(0)+"xx"),j(""+h+"."+e.status)):void 0)}))}},m=function(a){var b;return null==a&&(a=""),b=e.filter([f,a],e.identity).join("."),y(b)},k={send:o,count:j,timer:s,now:c,requests:n,sendPerformanceData:p,flush:w,history:l,active:h,enableAjaxMonitoring:e.bind(n.monitor,n)},e.map([k,k.timer,k.requests],g.wrap),e.extend(m,k)},v=y(),"undefined"!=typeof module&&null!==module&&null!=(G=module.promise)&&G.resolve(v),v},"undefined"!=typeof window&&null!==window?hubspot.define("hubspot.bucky.client",["enviro","_","jQuery","hubspot.buttercream.frosting"],a):module.exports=a(require("enviro"),require("underscore"),require("jquery"),require("buttercream"))}).call(this);