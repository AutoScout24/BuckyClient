/*! bucky 0.1.13 */
(function(){var a,b,c,d,e,f,g=[].slice;e=null!=("undefined"!=typeof process&&null!==process?process.hrtime:void 0)?function(){var a;return a=process.hrtime(),1e3*(a[0]+a[1]/1e9)}:function(){var a,b;return null!=(a=null!=(b=window.performance)?"function"==typeof b.now?b.now():void 0:void 0)?a:+new Date},c=+new Date,f=window.XMLHttpRequest,b=function(){var a,b,c,d,e,f,h,i;for(a=arguments[0],d=2<=arguments.length?g.call(arguments,1):[],i=d.reverse(),f=0,h=i.length;h>f;f++){c=i[f];for(b in c)e=c[b],a[b]=e}return a},d=function(){var a,b;return a=1<=arguments.length?g.call(arguments,0):[],null!=("undefined"!=typeof console&&null!==console?null!=(b=console.log)?b.call:void 0:void 0)?console.log.apply(console,a):void 0},d.error=function(){var a,b;return a=1<=arguments.length?g.call(arguments,0):[],null!=("undefined"!=typeof console&&null!==console?null!=(b=console.error)?b.call:void 0:void 0)?console.error.apply(console,a):void 0},a=function(){var a,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y;return l={host:"/bucky",maxInterval:3e4,aggregationInterval:5e3,decimalPrecision:3,sendLatency:!1,sample:1,active:!0},r=b({},l),i={timer:"ms",gauge:"g",counter:"c"},a=r.active,(x=function(){return a=r.active&&Math.random()<r.sample})(),h={},w=function(a){return b(r,a),"sample"in a&&x(),r},t=function(a,b){return null==b&&(b=r.decimalPrecision),a.toFixed(b)},s={},m=function(b,c,d){var e,f;if(a)return e=1,b in s&&("counter"===d?c+=s[b].value:(e=null!=(f=s[b].count)?f:e,e++,c=s[b].value+(c-s[b].value)/e)),h[b]=s[b]={value:c,type:d,count:e},j()},v=null,q=null,n=function(){return clearTimeout(v),clearTimeout(q),q=null,v=null,u()},j=function(){return clearTimeout(v),v=setTimeout(n,r.aggregationInterval),null==q?q=setTimeout(n,r.maxInterval):void 0},u=function(){var b,c,g,h,j,k,l,m;if(!a)return d("Would send bucky queue"),void 0;g={};for(c in s)h=s[c],null!=i[h.type]?(l=h.value,("gauge"===(m=h.type)||"timer"===m)&&(l=t(l)),g[c]=""+l+"|"+i[h.type],1!==h.count&&(g[c]+="@"+t(1/h.count,5))):d.error("Type "+h.type+" not understood by Bucky");return k=e(),b=JSON.stringify(g),j=new f,j.open("POST",""+r.host+"/send",!0),j.setRequestHeader("Content-Type","application/json"),j.setRequestHeader("Content-Length",b.length),j.addEventListener("load",function(){return y(e()-k)},!1),j.send(b),s={}},k=0,o=!1,y=function(a){return k=a,r.sendLatency&&!o?(m("bucky.latency",a,"timer"),o=!0,setTimeout(function(){return o=!1},3e5)):void 0},p=function(b){var i,j,k,l,o,q,r,s,t,u,v,x;null==b&&(b=""),i=function(a){return(null!=b?b.length:void 0)?a=b+"."+a:void 0},r=function(a,b,c){return null==c&&(c="gauge"),m(i(a),b,c)},u={TIMES:{},send:function(a,b){return r(a,b,"timer")},time:function(){var a,b,c,d,e;return e=arguments[0],a=arguments[1],c=arguments[2],b=4<=arguments.length?g.call(arguments,3):[],u.start(e),d=function(){return u.stop(e)},b.splice(0,0,d),a.apply(c,b)},timeSync:function(){var a,b,c,d,e;return d=arguments[0],a=arguments[1],c=arguments[2],b=4<=arguments.length?g.call(arguments,3):[],u.start(d),e=a.apply(c,b),u.stop(d),e},wrap:function(a,b){return null!=b?function(){var c;return c=1<=arguments.length?g.call(arguments,0):[],u.timeSync.apply(u,[a,b,this].concat(g.call(c)))}:function(b){return function(){var c;return c=1<=arguments.length?g.call(arguments,0):[],u.timeSync.apply(u,[a,b,this].concat(g.call(c)))}}},start:function(a){return u.TIMES[a]=e()},stop:function(a){var b;return null==u.TIMES[a]?(d.error("Timer "+a+" ended without having been started"),void 0):(b=e()-u.TIMES[a],u.TIMES[a]=void 0,u.send(a,b))},stopwatch:function(a,b){var c,d;return null!=b?d=function(){return+new Date}:(d=e,b=d()),c=b,{mark:function(c,e){var f;return null==e&&(e=0),f=d(),a&&(c=a+"."+c),u.send(c,f-b+e)},split:function(b,e){var f;return null==e&&(e=0),f=d(),a&&(b=a+"."+b),u.send(b,f-c+e),c=f}}},mark:function(a,b){var c;return null==b&&(b=+new Date),c=u.navigationStart(),u.send(a,b-c)},navigationStart:function(){var a,b,d;return null!=(a="undefined"!=typeof window&&null!==window?null!=(b=window.performance)?null!=(d=b.timing)?d.navigationStart:void 0:void 0:void 0)?a:c},responseEnd:function(){var a,b,d;return null!=(a="undefined"!=typeof window&&null!==window?null!=(b=window.performance)?null!=(d=b.timing)?d.responseEnd:void 0:void 0:void 0)?a:c},now:function(){return e()}},j=function(a,b){return null==b&&(b=1),r(a,b,"counter")},t=!1,s=function(a){var b,c,d,e,f,g;if(null==a&&(a="timing"),null==("undefined"!=typeof window&&null!==window?null!=(e=window.performance)?e.timing:void 0:void 0))return!1;if(t)return!1;if("uninitialized"===(f=document.readyState)||"loading"===f)return"function"==typeof document.addEventListener&&document.addEventListener("DOMContentLoaded",function(){return s.apply(this,arguments)},!1),!1;t=!0,c=window.performance.timing.navigationStart,g=window.performance.timing;for(b in g)d=g[b],d&&u.send(""+a+"."+b,d-c);return!0},q={tranforms:{mapping:{guid:/\/[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}/gi,sha1:/\/[0-9a-f]{40}/gi,md5:/\/[0-9a-f]{32}/gi,id:/\/[0-9;_\-]+/g,email:/\/[^/]+@[^/]+/g,domain:/\/[^/]+\.[a-z]{2,3}/gi},enabled:["guid","sha1","md5","id","email","domain"],enable:function(a,b,c){return null==c&&(c=""),null!=b&&(this.mapping[a]=[b,c]),this.enabled.splice(0,0,a)},disable:function(a){var b,c,d;d=this.enabled;for(c in d)if(b=d[c],c===a)return this.enabled.splice(b,1),void 0}},sendReadyStateTimes:function(a,b){var c,d,e,f,g,h,i,j;if(null!=b){d={1:"sending",2:"headers",3:"waiting",4:"receiving"},e={},f=null;for(c in b)h=b[c],null!=f&&null!=d[c]&&(e[d[c]]=h-f),f=h;j=[];for(g in e)i=e[g],j.push(u.send(""+a+"."+g,i));return j}},urlToKey:function(a,b,c){var e,f,g,h,i,j,k,l,m,n;for(a=a.replace(/https?:\/\//i,""),h=/([^/:]*)(?::\d+)?(\/[^\?#]*)?.*/i.exec(a),e=h[1],i=null!=(m=h[2])?m:"",n=this.transforms.enabled,k=0,l=n.length;l>k;k++)g=n[k],f=this.transforms.mapping[g],null!=f?"function"!=typeof f?("string"==typeof f&&(f=[f,""]),i=i.replace(f[0],f[1])):i=f(i,a,b,c):d.error("Bucky Error: Attempted to enable a mapping which is not defined: "+g);return i=decodeURIComponent(i),i=i.replace(/[^a-zA-Z0-9\-\.\/ ]+/g,"_"),j=e+i.replace(/[\/ ]/g,"."),j=j.replace(/(^\.)|(\.$)/g,""),j=j.replace(/\.com/,""),j=j.replace(/www\./,""),c&&(j=c+"."+j),b&&(j=j+"."+b.toLowerCase()),j=j.replace(/\.\./g,".")},getFullUrl:function(a,b){return null==b&&(b=document.location),/^\//.test(a)?b.hostname+a:/https?:\/\//i.test(a)?a:b.toString()+a},monitor:function(a){var b,c;return null==a&&(a="requests"),c=this,b=function(b){var d,f,g,h,i,k,l;return k=b.type,l=b.url,f=b.event,g=b.request,h=b.startTime,null!=h?(d=e()-h,l=c.getFullUrl(l),i=c.urlToKey(l,k,a),r(i,d,"timer"),c.sendReadyStateTimes(i,readyStateTimes),null!=(null!=g?g.status:void 0)?(g.status>12e3?j(""+i+".0"):0!==g.status&&j(""+i+"."+g.status.toString().charAt(0)+"xx"),j(""+i+"."+g.status)):void 0):void 0},window.XMLHttpRequest=function(){var a,c,g,h,i,j;g=new f;try{h=null,c={},i=g.open,g.open=function(a,f){var j;try{c[0]=e(),g.addEventListener("readystatechange",function(){return c[g.readyState]=e()},!1),g.addEventListener("loadend",function(d){return b({type:a,url:f,event:d,startTime:h,readyStateTimes:c,request:g})},!1)}catch(k){j=k,d.error("Bucky error monitoring XHR open call",j)}return i.apply(g,arguments)},j=g.start,g.start=function(){return h=e(),j.apply(g,arguments)}}catch(k){a=k,d.error("Bucky error monitoring XHR",a)}return g}}},o=function(a){var c;return null==a&&(a=""),c=null!=b?b:"",c&&a&&(c+="."),a&&(c+=a),p(c)},k={send:r,count:j,timer:u,now:e,requests:q,sendPerformanceData:s,flush:n,setOptions:w,history:h,active:a,enableAjaxMonitoring:function(){return q.monitor.apply(q,arguments)}},x=[];for(l in k)v=k[l],x.push(o[l]=v);return x},p()},"function"==typeof define&&define.amd?define(a):"object"==typeof exports?module.exports=a():window.Bucky=a()}).call(this);